"""
По IP который мы определили в предыдущей программе, получаем ряд сведений.
"""
import pygeoip
import re
import os


def site_location():
    ip = input('Enter IP: ')
    if 'GeoIPCity.dat' in os.listdir(os.getcwd()):
        gi = pygeoip.GeoIP('GeoIPCity.dat')
    else:
        directory = input('Enter the GeoIPCity.dat file directory: ')
        while directory.split('/')[-1] != 'GeoIPCity.dat':
            directory = input('\nEnter the right path to GeoIPCity.dat file: ')
        else:
            gi = pygeoip.GeoIP(directory)

    while re.fullmatch(
            r'(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)', ip) is None:
        print('\nIP-address format is XXX.XXX.XXX.XXX with the maximum value of XXX as 255.')
        ip = input('Enter IP: ')
    else:
        try:
            city = gi.record_by_addr(ip)
        except NoneType:
            return f'Sorry, I cannot work with this IP {ip}.'
        except Exception as e:
            return f'{ip} ERROR --- {e}'
        else:
            results = {}
            for key in city:
                if city[key] is None or city[key] == 0:
                    continue
                else:
                    results[key] = city[key]

            return results
