"""
Напишите многопоточный сканер портов, используя модуль multiprocessing и
класс Pool. Сканер принимает на вход любой диапазон IP-адресов и сканирует их
на наличие открытых портов следующего ряда:
43, 80, 109, 110, 115, 118, 119, 143, 194, 220, 443, 540, 585, 591, 1112, 1433, 1443,
3128, 3197, 3306, 3899, 4224, 4444, 5000, 5432, 6379, 8000, 8080, 10000.
"""

import socket
from netaddr import IPRange
from multiprocessing import Pool


def scanner(args):
    host, port = args
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(0.5)
    try:
        s.connect((host, port))
        print(f'{host}, Port {port:<5} is open.')
        return port, True

    except (socket.timeout, socket.error):
        print(f'{host}, Port {port:<5} is not open.')
        return port, False

    finally:
        s.close()


if __name__ == '__main__':
    ipStart, ipEnd = input('Enter IP -- IP: ').split(' -- ')
    iprange = IPRange(ipStart, ipEnd)

    ports = [43, 80, 109, 110, 115, 118, 119, 143, 194, 220, 443, 540, 585, 591, 1112, 1433, 1443,
             3128, 3197, 3306, 3899, 4224, 4444, 5000, 5432, 6379, 8000, 8080, 10000]

    pool = Pool(processes=max(len(iprange), len(ports)))
    for ip in iprange:
        host = str(ip)
        pool.imap_unordered(scanner, [(host, port) for port in ports])
